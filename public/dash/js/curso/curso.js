
$(document).ready(function() {
    /* Personal Information */
    if ($("#newCurso").length >= 1) {
        function validateEditor() {
            // Revalidate the content when its value is changed by Summernote
            $('#summernoteForm').formValidation('revalidateField', 'content');
        }

        $('#newCurso').formValidation({
            framework: 'bootstrap',
            icon: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            excluded: ':disabled',
            fields: {
                title: {
                    validators: {
                        notEmpty: {
                            message: 'El Titulo es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 77,
                            message: 'El titulo debe ser mayor de 10 y menor de 77 caracteres de longitud.'
                        }
                    }
                },
                permalink: {
                    validators: {
                        notEmpty: {
                            message: 'El Permalink o Url es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 77,
                            message: 'El Permalink o Url  debe ser mayor de 10 y menor de 77 caracteres de longitud.'
                        }
                    }
                },
                image_principal: {
                    validators: {
                        notEmpty: {
                            message: 'La imagen principal es campo necesario y no puede estar vacío.'
                        }
                    }
                },
                summary: {
                    validators: {
                        notEmpty: {
                            message: 'El sumario es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 200,
                            message: 'El sumario debe ser mayor de 10 y menor de 200 caracteres de longitud.'
                        }
                    }
                },
                content: {
                    validators: {
                        callback: {
                            message: 'The content is required and cannot be empty',
                            callback: function (value, validator, $field) {
                                var code = $('[name="content"]').code();
                                // <p><br></p> is code generated by Summernote for empty content
                                return (code !== '' && code !== '<p><br></p>');
                            }
                        }
                    }
                },
                status: {
                    validators: {
                        notEmpty: {
                            message: 'El status no puede estar vacio.'
                        }
                    }
                },
                category: {
                    validators: {
                        notEmpty: {
                            message: 'La categoria no puede estar vacio.'
                        }
                    }
                },
                subcategory: {
                    validators: {
                        notEmpty: {
                            message: 'La subcategory no puede estar vacio.'
                        }
                    }
                }
            }
        }).on('success.form.fv', function (e) {
            e.preventDefault();
            $("#btn-submit").attr("disabled", "disabled").val("Iniciando");
            $("#message-box-info").toggleClass("open");
            var values = {
                key: $('#key-security').attr('data-key'),
                value: $('#value-security').attr('data-value'),
                content: $('.summernote').code()
            };
            var data = $(this).serialize() + "&" + jQuery.param(values);
            $.ajax({
                type: "POST",
                url: "savenote",
                data: data,
                dataType: "json",
                success: function (response) {
                    if (response.message == "SUCCESS" && response.code == 200) {
                        $("#message-box-info").removeClass("open");
                        $("#message-box-success").toggleClass("open");
                        setTimeout(function () {
                            window.location = "/dashboard/notes";
                        }, 3000);
                    } else if (response.code == 404) {
                        $("#message-box-info").removeClass("open");
                        $("#message-box-warning").toggleClass("open");
                    }
                },
                error: function () {
                    $("#message-box-info").removeClass("open");
                }
            });
        });
        $("#cid").select2({
            maximumSelectionLength: 1,
            placeholder: "Categoría"
        });
        $('#cid').on("select2:select", function (response) {
            var category = response.target.value;
            console.log(category);
            $.ajax({
                data: {category: category},
                url: "/dashboard/notes/category",
                type: "POST",
                dataType: "json",
                success: function (response) {
                    if (response.code == 200) {
                        $("#select-scid").parent().removeClass("hide");
                        var sel = $("select[name='subcategory']");
                        for (value in response.result) {
                            sel.append($("<option class='options'>").attr('value', value).text(response.result[value]));
                        }
                        $("#scid").select2({
                            maximumSelectionLength: 1,
                            placeholder: "Selecciona la subcategoría"
                        }).focus();
                    }
                }
            });
        });
        $('#cid').on("select2:unselect", function () {
            $("#scid").select2('val', "");
            $('form[name="newNote"]').formValidation('revalidateField', 'subcategory');
            $("#select-scid #scid").find(".options").remove();
        });
    }
    /* Personal Information */
    /* Update Note */
    if ($("#updateCurso").length >= 1) {
        function validateEditor() {
            // Revalidate the content when its value is changed by Summernote
            $('#summernoteForm').formValidation('revalidateField', 'content');
        }

        (function ($) {
            $.fn.datepicker.dates['es'] = {
                days: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"],
                daysShort: ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
                daysMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa", "Do"],
                months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
                monthsShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
                today: "Hoy",
                clear: "Borrar",
                weekStart: 1,
                format: "dd/mm/yyyy"
            };
        }(jQuery));
        $('#datepicker').datepicker({
            format: 'dd/mm/yyyy',
            language: "es",
            autoclose: true
        })
            .on('changeDate', function (e) {
                // Revalidate the date field
                $('#newNote').formValidation('revalidateField', 'dateP');
            });
        $('#updateNote').formValidation({
            framework: 'bootstrap',
            icon: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            excluded: ':disabled',
            fields: {
                title: {
                    validators: {
                        notEmpty: {
                            message: 'El Titulo es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 100,
                            message: 'El titulo debe ser mayor de 10 y menor de 100 caracteres de longitud.'
                        }
                    }
                },
                permalink: {
                    validators: {
                        notEmpty: {
                            message: 'El Permalink o Url es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 100,
                            message: 'El Permalink o Url  debe ser mayor de 10 y menor de 100 caracteres de longitud.'
                        }
                    }
                },
                dateP: {
                    validators: {
                        notEmpty: {
                            message: 'La fecha es necesaría'
                        },
                        date: {
                            format: 'DD/MM/YYYY',
                            message: 'El formato de fecha introducido no es valido'
                        }
                    }
                },
                image_principal: {
                    validators: {
                        notEmpty: {
                            message: 'La imagen principal es campo necesario y no puede estar vacío.'
                        }
                    }
                },
                summary: {
                    validators: {
                        notEmpty: {
                            message: 'El sumario es necesario y no puede estar vacío.'
                        },
                        stringLength: {
                            min: 10,
                            max: 200,
                            message: 'El sumario debe ser mayor de 10 y menor de 100 caracteres de longitud.'
                        }
                    }
                },
                content: {
                    validators: {
                        callback: {
                            message: 'The content is required and cannot be empty',
                            callback: function (value, validator, $field) {
                                var code = $('[name="content"]').code();
                                // <p><br></p> is code generated by Summernote for empty content
                                return (code !== '' && code !== '<p><br></p>');
                            }
                        }
                    }
                },
                status: {
                    validators: {
                        notEmpty: {
                            message: 'El status no puede estar vacio.'
                        }
                    }
                },
                category: {
                    validators: {
                        notEmpty: {
                            message: 'La categoria no puede estar vacio.'
                        }
                    }
                },
                subcategory: {
                    validators: {
                        notEmpty: {
                            message: 'La subcategory no puede estar vacio.'
                        }
                    }
                }
            }
        }).on('success.form.fv', function (e) {
            e.preventDefault();
            $("#btn-submit").attr("disabled", "disabled").val("Iniciando");
            $("#message-box-info").toggleClass("open");
            var values = {
                key: $('#key-security').attr('data-key'),
                value: $('#value-security').attr('data-value'),
                content: $('.summernote').code()
            };
            var data = $(this).serialize() + "&" + jQuery.param(values);
            $.ajax({
                type: "POST",
                url: "updatenote",
                data: data,
                dataType: "json",
                success: function (response) {
                    if (response.message == "SUCCESS" && response.code == 200) {
                        $("#message-box-info").removeClass("open");
                        $("#message-box-success").toggleClass("open");
                        setTimeout(function () {
                            $("#message-box-success").removeClass("open");
                        }, 3000);
                    } else if (response.code == 404) {
                        $("#message-box-info").removeClass("open");
                        $("#message-box-warning").toggleClass("open");
                    }
                },
                error: function () {
                    $("#message-box-info").removeClass("open");
                }
            });
        });
        $("#cid").select2({
            maximumSelectionLength: 1,
            placeholder: "Categoría"
        });
        $("#scid").select2({
            maximumSelectionLength: 1,
            placeholder: "Selecciona la subcategoría"
        }).focus();
        $('#cid').on("select2:select", function (response) {
            var category = response.target.value;
            $.ajax({
                data: {category: category},
                url: "/dashboard/notes/category",
                type: "POST",
                dataType: "json",
                success: function (response) {
                    if (response.code == 200) {
                        $("#select-scid").parent().removeClass("hide");
                        var sel = $("select[name='subcategory']");
                        for (value in response.result) {
                            sel.append($("<option class='options'>").attr('value', value).text(response.result[value]));
                        }
                        $("#scid").select2({
                            maximumSelectionLength: 1,
                            placeholder: "Selecciona la subcategoría"
                        }).focus();
                    }
                }
            });
        });
        $('#cid').on("select2:unselect", function () {
            $("#scid").select2('val', "");
            $('form[name="updateNote"]').formValidation('revalidateField', 'subcategory');
            $("#select-scid #scid").find(".options").remove();
        });
    }
    /* Update Note */
    /* Validate title */
    if ($("#note-title").length >= 1) {
        $("#note-title").change(function () {
            var $input_loader = $("#input-loader");
            $input_loader.removeClass("fade");
            var title_note = $(this).val();
            $.ajax({
                url: "/dashboard/notes/validateurl",
                type: "POST",
                data: {
                    title: title_note,
                    key: $('#key-security').attr('data-key'),
                    value: $('#value-security').attr('data-value')
                },
                dataType: "json",
                success: function (response) {
                    if (response.message == "SUCCESS" && response.code == 200) {
                        $("#note-permalink").val(response.new_url);
                        $('#newNote').formValidation('revalidateField', 'permalink');
                    } else {
                        $input_loader.addClass("hide");
                        alert("Ha ocurrido un error intente nuevamente.");
                    }
                },
                complete: function () {
                    $input_loader.addClass("hide");
                }
            });
        });
    }
});